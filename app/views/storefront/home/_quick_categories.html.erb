<!-- app/views/storefront/home/_quick_categories.html.erb -->
<section class="container-fluid px-2 px-md-3 px-xl-4 home-categories">
  <div class="section-head d-flex align-items-baseline gap-3">
    <h2 class="h6 mb-0">Shop by category</h2>
    <%= link_to "All products â†’", storefront_products_path, class: "link-quiet small" %>
  </div>

  <div class="section-body mt-2">
    <div class="chips d-flex flex-wrap gap-2">
      <% (@categories || Category.order(:name)).first(12).each do |c| %>
        <% next if c.blank? %>
        <%= link_to storefront_category_path(c), class: "chip chip-link" do %>
          <%= c.name %>
          <%# Prefer counter_cache to avoid loading associations; fallback if nil %>
          <% count = c.try(:products_count) %>
          <% count ||= c.respond_to?(:products) ? c.products.size : nil %>
          <% if count.present? %>
            (<%= count %>)
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
</section>
