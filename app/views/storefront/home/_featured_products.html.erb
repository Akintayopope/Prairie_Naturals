<section>
  <header class="text-center mb-4">
    <h2 class="pn-section-title">Featured Products</h2>
    <p class="text-muted mb-0">A curated selection from our catalog â€” pure, purposeful, and loved by our community.</p>
  </header>

  <div class="row g-3 row-cols-1 row-cols-md-2 row-cols-lg-3">
    <% (@featured_products || []).each do |product| %>
      <div class="col">
        <article class="pn-feature-card h-100">
          <div class="pn-feature-card__media">
            <%= link_to storefront_product_path(product) do %>
              <% if product.images.attached? %>
                <% img = product.images.first %>
                <%= image_tag img.variant(resize_to_limit: [800,800]),
                      alt: product.name, loading: "lazy", width: 800, height: 800 %>
              <% elsif product.image_url.present? %>
                <%= image_tag product.image_url, alt: product.name, loading: "lazy", width: 800, height: 800 %>
              <% else %>
                <div class="pn-card__img pn-card__img--ph">No image</div>
              <% end %>
            <% end %>
          </div>

          <div class="pn-feature-card__body">
            <% if (category_name = product.category&.name).present? %>
              <span class="pn-badge"><%= category_name %></span>
            <% end %>

            <h3 class="pn-feature-card__title"><%= product.name %></h3>

            <% sale = product.try(:sale_price).present? && product.sale_price.to_d < product.price.to_d rescue false %>
            <div class="small mt-1 mb-2">
              <% if sale %>
                <span class="text-danger fw-semibold"><%= number_to_currency(product.sale_price) %></span>
                <span class="price-old"><%= number_to_currency(product.price) %></span>
              <% else %>
                <span class="fw-semibold"><%= number_to_currency(product.price || 0) %></span>
              <% end %>
            </div>

            <%= link_to "Shop this product",
                        storefront_product_path(product),
                        class: "btn btn-lift" %>
          </div>
        </article>
      </div>
    <% end %>
  </div>

  <div class="text-center mt-4">
    <%= link_to "View All Products", storefront_products_path, class: "btn btn-cta" %>
  </div>
</section>
