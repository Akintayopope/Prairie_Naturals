<h1>Our Products</h1>

<div class="filter">
  <%= form_with url: storefront_products_path, method: :get, local: true, id: "product-filter-form" do %>
    <label><strong>Search:</strong></label>
    <%= text_field_tag :search, params[:search], placeholder: "Search products..." %>

    <label><strong>Category:</strong></label>
    <%= select_tag :category_id,
        options_from_collection_for_select(@categories, :id, :name, params[:category_id]),
        include_blank: "All Categories" %>

    <%= submit_tag "Filter", class: "btn btn-primary" %>
  <% end %>
</div>


<!-- Product List -->
<div class="products">
  <% @products.each do |product| %>
    <div class="product-card">
      <% if product.images.attached? %>
        <%= image_tag url_for(product.images.first), alt: product.name, class: "product-thumb", style: "max-width: 150px;" %>

      <% else %>
        <p><em>No image available</em></p>
      <% end %>

      <h3><%= link_to product.name, storefront_product_path(product) %></h3>
      <p><%= truncate(product.description, length: 100) %></p>
      <p><strong>Price:</strong> $<%= number_with_precision(product.price, precision: 2) %></p>
    </div>
  <% end %>
</div>

<script>
  document.addEventListener("turbo:load", function () {
    const form = document.getElementById("product-filter-form");
    if (form) {
      form.querySelectorAll("input, select").forEach(el => {
        el.addEventListener("change", () => form.requestSubmit());
      });
    }
  });
</script>


<!-- Pagination -->
<div class="pagination">
  <%= paginate @products %>
</div>
